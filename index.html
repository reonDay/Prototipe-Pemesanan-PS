<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Ruangan PlayStation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 8px;
            position: relative;
        }
        
        .auth-buttons {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .auth-btn {
            background-color: #1a252f;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .auth-btn.owner {
            background-color: #8e44ad;
        }
        
        .auth-btn.kasir {
            background-color: #16a085;
        }
        
        h1 {
            margin-bottom: 10px;
        }
        
        .info {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .ruangan-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .ruangan-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .ruangan-card:hover {
            transform: translateY(-5px);
        }
        
        .ruangan-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        
        .ps4 {
            border-left: 5px solid #3498db;
        }
        
        .ps5 {
            border-left: 5px solid #e74c3c;
        }
        
        .booking-list {
            margin-top: 15px;
        }
        
        .booking-item {
            background-color: #f9f9f9;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .booking-actions {
            display: flex;
            gap: 5px;
        }
        
        .booking-actions button {
            padding: 5px 10px;
            font-size: 0.8rem;
        }
        
        .available {
            color: #27ae60;
            font-weight: bold;
        }
        
        .unavailable {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .booking-form {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            background-color: #2c3e50;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }
        
        button:hover {
            background-color: #1a252f;
        }
        
        .harga {
            font-size: 1.2rem;
            font-weight: bold;
            color: #e74c3c;
            margin-top: 20px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #7f8c8d;
        }
        
        /* Kasir Section */
        .kasir-section {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
            display: none;
        }
        
        .kasir-section h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        /* Owner Section */
        .owner-section {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
            display: none;
        }
        
        .owner-section h2 {
            margin-bottom: 20px;
            color: #8e44ad;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        .insight-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .insight-card {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 5px solid #8e44ad;
        }
        
        .insight-card h3 {
            color: #8e44ad;
            margin-bottom: 10px;
        }
        
        .booking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .booking-table th, .booking-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .booking-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        .booking-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .booking-table tr:hover {
            background-color: #f1f1f1;
        }
        
        .action-btn {
            padding: 6px 12px;
            margin-right: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .edit-btn {
            background-color: #3498db;
            color: white;
        }
        
        .delete-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .download-btn {
            background-color: #8e44ad;
            color: white;
            margin-top: 20px;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            width: 400px;
            max-width: 90%;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .error-message {
            color: #e74c3c;
            margin-top: 5px;
            font-size: 0.9rem;
        }
        
        /* Payment Options */
        .payment-options {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .payment-option {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 150px;
            text-align: center;
        }
        
        .payment-option:hover {
            border-color: #3498db;
            background-color: #f8f9fa;
        }
        
        .payment-option.selected {
            border-color: #3498db;
            background-color: #e3f2fd;
        }
        
        .payment-option i {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .payment-option.xendit i {
            color: #635bff;
        }
        
        .payment-option.cash i {
            color: #27ae60;
        }
        
        .payment-modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            width: 500px;
            max-width: 90%;
            text-align: center;
        }
        
        .payment-instructions {
            text-align: left;
            margin: 20px 0;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        
        .payment-instructions ol {
            padding-left: 20px;
        }
        
        .payment-instructions li {
            margin-bottom: 10px;
        }
        
        .qr-code {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            background-color: #f1f1f1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }
        
        .payment-success {
            text-align: center;
            padding: 20px;
        }
        
        .payment-success i {
            font-size: 4rem;
            color: #27ae60;
            margin-bottom: 20px;
        }
        
        .xendit-payment-container {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        
        .xendit-logo {
            font-weight: bold;
            color: #635bff;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .ruangan-list {
                grid-template-columns: 1fr;
            }
            
            .auth-buttons {
                position: static;
                margin-bottom: 15px;
                text-align: center;
                flex-direction: row;
                justify-content: center;
            }
            
            .booking-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .booking-actions {
                margin-top: 10px;
                align-self: flex-end;
            }
            
            .insight-grid {
                grid-template-columns: 1fr;
            }
            
            .payment-options {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Booking Ruangan PlayStation</h1>
            <p>Buka Senin - Minggu, Jam 08:00 - 24:00</p>
            <div class="auth-buttons">
                <button id="btnKasir" class="auth-btn kasir">Login sebagai Kasir</button>
                <button id="btnOwner" class="auth-btn owner">Login sebagai Owner</button>
                <button id="btnLogout" class="auth-btn" style="display: none;">Logout</button>
            </div>
        </header>
        
        <div class="info">
            <p><strong>Informasi:</strong> Setiap sesi booking memiliki jeda 5 menit untuk setup dan bersih-bersih.</p>
            <p>Harga: PS4 - Rp 25.000/jam, PS5 - Rp 35.000/jam</p>
            <p class="unavailable">Booking hanya dapat dilakukan untuk hari ini dan besok saja.</p>
        </div>
        
        <h2>Daftar Ruangan</h2>
        <div class="ruangan-list" id="ruanganList">
            <!-- Ruangan akan diisi oleh JavaScript -->
        </div>
        
        <div class="booking-form" id="bookingForm">
            <h2>Form Pemesanan</h2>
            <div class="form-group">
                <label for="nama">Nama Pemesan:</label>
                <input type="text" id="nama" placeholder="Masukkan nama anda">
            </div>
            
            <div class="form-group">
                <label for="hp">No. HP (Opsional):</label>
                <input type="text" id="hp" placeholder="Masukkan nomor HP">
            </div>
            
            <div class="form-group">
                <label for="ruangan">Pilih Ruangan:</label>
                <select id="ruangan">
                    <option value="">-- Pilih Ruangan --</option>
                    <!-- Opsi ruangan akan diisi oleh JavaScript -->
                </select>
            </div>
            
            <div class="form-group">
                <label for="tanggal">Tanggal Booking:</label>
                <input type="date" id="tanggal">
                <div class="error-message" id="tanggalError"></div>
            </div>
            
            <div class="form-group">
                <label for="jamMulai">Jam Mulai:</label>
                <select id="jamMulai">
                    <option value="">-- Pilih Jam Mulai --</option>
                    <!-- Opsi jam akan diisi oleh JavaScript -->
                </select>
                <div class="error-message" id="jamError"></div>
            </div>
            
            <div class="form-group">
                <label for="durasi">Durasi Booking (jam):</label>
                <select id="durasi">
                    <option value="1">1 jam</option>
                    <option value="2">2 jam</option>
                    <option value="3">3 jam</option>
                    <option value="4">4 jam</option>
                </select>
            </div>
            
            <button id="btnHitung">Hitung Harga</button>
            
            <div class="harga" id="hargaContainer">
                Total Harga: Rp <span id="harga">0</span>
            </div>
            
            <div class="payment-options" id="paymentOptions" style="display: none;">
                <div class="payment-option xendit" data-method="xendit">
                    <i class="fas fa-credit-card"></i>
                    <div class="xendit-logo">XENDIT</div>
                    <p>Pembayaran Digital</p>
                </div>
                <div class="payment-option cash" data-method="cash">
                    <i class="fas fa-money-bill-wave"></i>
                    <div>Bayar di Tempat</div>
                    <p>Cash</p>
                </div>
            </div>
            
            <button id="btnBooking" style="margin-top: 20px; background-color: #27ae60;">Booking Sekarang</button>
        </div>
        
        <!-- Kasir Section -->
        <div class="kasir-section" id="kasirSection">
            <h2>Manajemen Booking - Panel Kasir</h2>
            <div class="form-group">
                <label for="filterTanggal">Filter Berdasarkan Tanggal:</label>
                <input type="date" id="filterTanggal">
            </div>
            <button id="btnFilter">Filter</button>
            <button id="btnResetFilter" style="background-color: #7f8c8d;">Reset Filter</button>
            
            <table class="booking-table">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Nama Pemesan</th>
                        <th>No. HP</th>
                        <th>Ruangan</th>
                        <th>Tanggal</th>
                        <th>Waktu</th>
                        <th>Durasi</th>
                        <th>Total Harga</th>
                        <th>Status Pembayaran</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="bookingTableBody">
                    <!-- Data booking akan diisi oleh JavaScript -->
                </tbody>
            </table>
        </div>
        
        <!-- Owner Section -->
        <div class="owner-section" id="ownerSection">
            <h2>Analisis Bisnis - Panel Owner</h2>
            
            <div class="insight-grid">
                <div class="insight-card">
                    <h3>Total Pendapatan</h3>
                    <p id="totalPendapatan">Rp 0</p>
                </div>
                <div class="insight-card">
                    <h3>Jumlah Booking</h3>
                    <p id="jumlahBooking">0</p>
                </div>
                <div class="insight-card">
                    <h3>Ruangan Paling Populer</h3>
                    <p id="ruanganPopuler">-</p>
                </div>
                <div class="insight-card">
                    <h3>Rata-rata Durasi Booking</h3>
                    <p id="rataDurasi">0 jam</p>
                </div>
                <div class="insight-card">
                    <h3>Pendapatan per Jenis</h3>
                    <p id="pendapatanPS4">PS4: Rp 0</p>
                    <p id="pendapatanPS5">PS5: Rp 0</p>
                </div>
                <div class="insight-card">
                    <h3>Metode Pembayaran</h3>
                    <p id="paymentXendit">Xendit: 0</p>
                    <p id="paymentCash">Cash: 0</p>
                </div>
            </div>
            
            <div class="form-group">
                <label for="ownerFilterTanggal">Filter Berdasarkan Tanggal:</label>
                <input type="date" id="ownerFilterTanggal">
                <span> hingga </span>
                <input type="date" id="ownerFilterTanggalEnd">
            </div>
            <button id="btnOwnerFilter">Filter</button>
            <button id="btnOwnerResetFilter" style="background-color: #7f8c8d;">Reset Filter</button>
            
            <button id="btnDownloadData" class="download-btn">Download Data Mentah (CSV)</button>
            
            <table class="booking-table">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Nama Pemesan</th>
                        <th>No. HP</th>
                        <th>Ruangan</th>
                        <th>Tanggal</th>
                        <th>Waktu</th>
                        <th>Durasi</th>
                        <th>Total Harga</th>
                        <th>Status Pembayaran</th>
                    </tr>
                </thead>
                <tbody id="ownerTableBody">
                    <!-- Data booking akan diisi oleh JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Modal Edit Booking -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Booking</h3>
                <button class="close-btn" id="closeEditModal">&times;</button>
            </div>
            <div class="form-group">
                <label for="editNama">Nama Pemesan:</label>
                <input type="text" id="editNama">
            </div>
            <div class="form-group">
                <label for="editHp">No. HP (Opsional):</label>
                <input type="text" id="editHp">
            </div>
            <div class="form-group">
                <label for="editRuangan">Ruangan:</label>
                <select id="editRuangan" disabled>
                    <!-- Opsi ruangan akan diisi oleh JavaScript -->
                </select>
            </div>
            <div class="form-group">
                <label for="editTanggal">Tanggal:</label>
                <input type="date" id="editTanggal">
            </div>
            <div class="form-group">
                <label for="editJamMulai">Jam Mulai:</label>
                <select id="editJamMulai">
                    <!-- Opsi jam akan diisi oleh JavaScript -->
                </select>
            </div>
            <div class="form-group">
                <label for="editDurasi">Durasi (jam):</label>
                <select id="editDurasi">
                    <option value="1">1 jam</option>
                    <option value="2">2 jam</option>
                    <option value="3">3 jam</option>
                    <option value="4">4 jam</option>
                </select>
            </div>
            <button id="btnUpdateBooking" style="background-color: #3498db;">Update Booking</button>
        </div>
    </div>
    
    <!-- Modal Pembayaran Xendit -->
    <div class="modal" id="paymentModal">
        <div class="payment-modal-content">
            <div class="modal-header">
                <h3>Pembayaran dengan Xendit</h3>
                <button class="close-btn" id="closePaymentModal">&times;</button>
            </div>
            <div id="paymentInstructions">
                <div class="xendit-payment-container">
                    <div class="xendit-logo">XENDIT PAYMENT GATEWAY</div>
                    <p>Total yang harus dibayar: <strong id="paymentAmount">Rp 0</strong></p>
                    <p>Silakan pilih metode pembayaran:</p>
                    
                    <div class="form-group">
                        <label for="paymentMethod">Metode Pembayaran:</label>
                        <select id="paymentMethod">
                            <option value="virtual_account">Virtual Account (Transfer Bank)</option>
                            <option value="ewallet">E-Wallet (DANA, OVO, LinkAja)</option>
                            <option value="qr_code">QR Code</option>
                            <option value="credit_card">Kartu Kredit</option>
                        </select>
                    </div>
                    
                    <div id="virtualAccountInfo" class="payment-instructions">
                        <h4>Instruksi Pembayaran Virtual Account:</h4>
                        <ol>
                            <li>Pilih transfer bank</li>
                            <li>Masukkan nomor virtual account: <strong id="vaNumber">8888800001234567</strong></li>
                            <li>Masukkan jumlah: <strong id="vaAmount">Rp 0</strong></li>
                            <li>Konfirmasi pembayaran</li>
                        </ol>
                    </div>
                    
                    <div id="ewalletInfo" class="payment-instructions" style="display: none;">
                        <h4>Instruksi Pembayaran E-Wallet:</h4>
                        <ol>
                            <li>Buka aplikasi e-wallet (DANA/OVO/LinkAja)</li>
                            <li>Pilih fitur pembayaran</li>
                            <li>Scan QR code di bawah atau masukkan kode pembayaran</li>
                            <li>Konfirmasi pembayaran</li>
                        </ol>
                        <div class="qr-code">
                            <i class="fas fa-qrcode" style="font-size: 100px; color: #333;"></i>
                        </div>
                    </div>
                    
                    <div id="creditCardInfo" class="payment-instructions" style="display: none;">
                        <h4>Pembayaran Kartu Kredit:</h4>
                        <div class="form-group">
                            <label for="cardNumber">Nomor Kartu:</label>
                            <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" value="4000000000000002">
                        </div>
                        <div class="form-group">
                            <label for="expiryDate">Tanggal Kadaluarsa:</label>
                            <input type="text" id="expiryDate" placeholder="MM/YY" value="12/30">
                        </div>
                        <div class="form-group">
                            <label for="cvv">CVV:</label>
                            <input type="text" id="cvv" placeholder="123" value="123">
                        </div>
                    </div>
                    
                    <button id="btnProcessPayment" style="margin-top: 20px; background-color: #635bff;">Proses Pembayaran</button>
                </div>
            </div>
            <div id="paymentSuccess" class="payment-success" style="display: none;">
                <i class="fas fa-check-circle"></i>
                <h3>Pembayaran Berhasil!</h3>
                <p>Terima kasih telah melakukan pembayaran melalui Xendit.</p>
                <p>Booking Anda telah dikonfirmasi dan diproses.</p>
                <button id="btnClosePayment" style="margin-top: 20px;">Tutup</button>
            </div>
            <div id="paymentProcessing" class="payment-success" style="display: none;">
                <i class="fas fa-spinner fa-spin"></i>
                <h3>Memproses Pembayaran...</h3>
                <p>Sedang memverifikasi pembayaran Anda.</p>
            </div>
        </div>
    </div>
    
    <footer>
        <p>&copy; 2023 Booking Ruangan PlayStation. All rights reserved.</p>
    </footer>

    <script src="https://js.xendit.co/v1/xendit.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inisialisasi Xendit dengan API Key sandbox
            const xendit = new Xendit({
                publicKey: 'xnd_public_development_O4iFfuQhgLOsl8o2kQ0V5L5Q1Qp5xV5ktUqFfUT8wS7o4p0epNpEJL7Xo4WXW' // Ganti dengan public key sandbox Anda
            });
            
            // Data ruangan
            const ruangan = [
                { id: 1, nama: 'Ruang PS4 1', jenis: 'PS4', harga: 25000 },
                { id: 2, nama: 'Ruang PS4 2', jenis: 'PS4', harga: 25000 },
                { id: 3, nama: 'Ruang PS4 3', jenis: 'PS4', harga: 25000 },
                { id: 4, nama: 'Ruang PS5 1', jenis: 'PS5', harga: 35000 },
                { id: 5, nama: 'Ruang PS5 2', jenis: 'PS5', harga: 35000 },
                { id: 6, nama: 'Ruang PS5 3', jenis: 'PS5', harga: 35000 }
            ];
            
            // Data booking (disimpan di localStorage)
            let bookings = JSON.parse(localStorage.getItem('bookings')) || [
                { id: 1, ruanganId: 1, nama: 'Rendy', hp: '08123456789', tanggal: new Date().toISOString().split('T')[0], jamMulai: '10:00', jamSelesai: '12:00', durasi: 2, totalHarga: 50000, paymentMethod: 'cash', paymentStatus: 'paid' },
                { id: 2, ruanganId: 1, nama: 'Cia', hp: '087654321', tanggal: new Date().toISOString().split('T')[0], jamMulai: '12:05', jamSelesai: '15:05', durasi: 3, totalHarga: 75000, paymentMethod: 'xendit', paymentStatus: 'paid' },
                { id: 3, ruanganId: 4, nama: 'Andi', hp: '', tanggal: new Date().toISOString().split('T')[0], jamMulai: '14:00', jamSelesai: '16:00', durasi: 2, totalHarga: 70000, paymentMethod: 'cash', paymentStatus: 'pending' }
            ];
            
            // Simpan ke localStorage
            localStorage.setItem('bookings', JSON.stringify(bookings));
            
            // Status login
            let isKasirLoggedIn = false;
            let isOwnerLoggedIn = false;
            let currentUserRole = null;
            let selectedPaymentMethod = null;
            let currentBookingData = null;
            
            // Set tanggal minimum ke hari ini
            const today = new Date();
            const todayFormatted = today.toISOString().split('T')[0];
            
            // Set tanggal maksimum ke besok
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowFormatted = tomorrow.toISOString().split('T')[0];
            
            // Set tanggal untuk filter owner (default 30 hari terakhir)
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            const thirtyDaysAgoFormatted = thirtyDaysAgo.toISOString().split('T')[0];
            
            document.getElementById('tanggal').setAttribute('min', todayFormatted);
            document.getElementById('tanggal').setAttribute('max', tomorrowFormatted);
            document.getElementById('tanggal').value = todayFormatted;
            document.getElementById('filterTanggal').value = todayFormatted;
            document.getElementById('ownerFilterTanggal').value = thirtyDaysAgoFormatted;
            document.getElementById('ownerFilterTanggalEnd').value = todayFormatted;
            
            // Generate opsi jam (08:00 - 23:00)
            const jamSelect = document.getElementById('jamMulai');
            const editJamSelect = document.getElementById('editJamMulai');
            for (let hour = 8; hour <= 23; hour++) {
                const option = document.createElement('option');
                option.value = `${hour.toString().padStart(2, '0')}:00`;
                option.textContent = `${hour.toString().padStart(2, '0')}:00`;
                jamSelect.appendChild(option);
                
                const editOption = option.cloneNode(true);
                editJamSelect.appendChild(editOption);
            }
            
            // Tampilkan daftar ruangan
            tampilkanRuangan();
            
            // Fungsi untuk menampilkan daftar ruangan
            function tampilkanRuangan() {
                const ruanganList = document.getElementById('ruanganList');
                const ruanganSelect = document.getElementById('ruangan');
                const editRuanganSelect = document.getElementById('editRuangan');
                
                // Kosongkan daftar sebelumnya
                ruanganList.innerHTML = '';
                ruanganSelect.innerHTML = '<option value="">-- Pilih Ruangan --</option>';
                editRuanganSelect.innerHTML = '';
                
                ruangan.forEach(r => {
                    // Tambahkan ke daftar ruangan
                    const card = document.createElement('div');
                    card.className = `ruangan-card ${r.jenis.toLowerCase()}`;
                    
                    const bookingForThisRoom = bookings.filter(b => b.ruanganId === r.id && b.tanggal === todayFormatted);
                    
                    let statusHTML = '<p class="available">Tersedia</p>';
                    if (bookingForThisRoom.length > 0) {
                        statusHTML = '<div class="booking-list">';
                        bookingForThisRoom.forEach(booking => {
                            statusHTML += `
                                <div class="booking-item">
                                    <div>
                                        <strong>${booking.jamMulai} - ${booking.jamSelesai}</strong><br>
                                        ${booking.nama} ${booking.hp ? `(${booking.hp})` : ''}
                                    </div>
                                    ${isKasirLoggedIn ? `
                                    <div class="booking-actions">
                                        <button class="edit-btn action-btn" data-id="${booking.id}">Edit</button>
                                        <button class="delete-btn action-btn" data-id="${booking.id}">Hapus</button>
                                    </div>
                                    ` : ''}
                                </div>
                            `;
                        });
                        statusHTML += '</div>';
                    }
                    
                    card.innerHTML = `
                        <h3>${r.nama}</h3>
                        <p>Jenis: ${r.jenis}</p>
                        <p>Harga: Rp ${r.harga.toLocaleString('id-ID')}/jam</p>
                        ${statusHTML}
                    `;
                    
                    ruanganList.appendChild(card);
                    
                    // Tambahkan ke dropdown pemilihan
                    const option = document.createElement('option');
                    option.value = r.id;
                    option.textContent = r.nama;
                    ruanganSelect.appendChild(option);
                    
                    // Tambahkan ke dropdown edit
                    const editOption = document.createElement('option');
                    editOption.value = r.id;
                    editOption.textContent = r.nama;
                    editRuanganSelect.appendChild(editOption);
                });
                
                // Tambahkan event listener untuk tombol edit dan hapus
                if (isKasirLoggedIn) {
                    document.querySelectorAll('.edit-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const bookingId = parseInt(this.getAttribute('data-id'));
                            bukaModalEdit(bookingId);
                        });
                    });
                    
                    document.querySelectorAll('.delete-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const bookingId = parseInt(this.getAttribute('data-id'));
                            hapusBooking(bookingId);
                        });
                    });
                }
            }
            
            // Validasi tanggal (hanya hari ini dan besok untuk client)
            document.getElementById('tanggal').addEventListener('change', function() {
                const selectedDate = this.value;
                const tanggalError = document.getElementById('tanggalError');
                
                if (!isKasirLoggedIn && selectedDate !== todayFormatted && selectedDate !== tomorrowFormatted) {
                    tanggalError.textContent = 'Booking hanya dapat dilakukan untuk hari ini dan besok saja.';
                    this.value = todayFormatted;
                } else {
                    tanggalError.textContent = '';
                }
            });
            
            // Hitung harga
            document.getElementById('btnHitung').addEventListener('click', function() {
                const ruanganId = document.getElementById('ruangan').value;
                const durasi = document.getElementById('durasi').value;
                
                if (!ruanganId) {
                    alert('Pilih ruangan terlebih dahulu!');
                    return;
                }
                
                const selectedRuangan = ruangan.find(r => r.id == ruanganId);
                const totalHarga = selectedRuangan.harga * durasi;
                
                document.getElementById('harga').textContent = totalHarga.toLocaleString('id-ID');
                
                // Tampilkan opsi pembayaran
                document.getElementById('paymentOptions').style.display = 'flex';
            });
            
            // Pilih metode pembayaran
            document.querySelectorAll('.payment-option').forEach(option => {
                option.addEventListener('click', function() {
                    // Hapus seleksi sebelumnya
                    document.querySelectorAll('.payment-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Tambahkan seleksi pada opsi yang dipilih
                    this.classList.add('selected');
                    selectedPaymentMethod = this.getAttribute('data-method');
                });
            });
            
            // Toggle informasi pembayaran berdasarkan metode yang dipilih
            document.getElementById('paymentMethod').addEventListener('change', function() {
                const method = this.value;
                
                // Sembunyikan semua info pembayaran
                document.getElementById('virtualAccountInfo').style.display = 'none';
                document.getElementById('ewalletInfo').style.display = 'none';
                document.getElementById('creditCardInfo').style.display = 'none';
                
                // Tampilkan info yang sesuai
                if (method === 'virtual_account') {
                    document.getElementById('virtualAccountInfo').style.display = 'block';
                } else if (method === 'ewallet') {
                    document.getElementById('ewalletInfo').style.display = 'block';
                } else if (method === 'credit_card') {
                    document.getElementById('creditCardInfo').style.display = 'block';
                }
            });
            
            // Fungsi untuk memeriksa bentrok jam
            function cekBentrokJam(ruanganId, tanggal, jamMulai, durasi, excludeBookingId = null) {
                const jamMulaiHour = parseInt(jamMulai.split(':')[0]);
                const jamSelesai = `${jamMulaiHour + parseInt(durasi)}:05`;
                
                for (const booking of bookings) {
                    if (booking.id === excludeBookingId) continue;
                    
                    if (booking.ruanganId == ruanganId && booking.tanggal === tanggal) {
                        const bookingJamMulai = parseInt(booking.jamMulai.split(':')[0]);
                        const bookingJamSelesai = parseInt(booking.jamSelesai.split(':')[0]);
                        
                        // Cek apakah ada bentrok
                        if (
                            (jamMulaiHour >= bookingJamMulai && jamMulaiHour < bookingJamSelesai) ||
                            (jamMulaiHour + parseInt(durasi) > bookingJamMulai && jamMulaiHour + parseInt(durasi) <= bookingJamSelesai) ||
                            (jamMulaiHour <= bookingJamMulai && jamMulaiHour + parseInt(durasi) >= bookingJamSelesai)
                        ) {
                            return `Bentrok dengan booking ${booking.nama} (${booking.jamMulai} - ${booking.jamSelesai})`;
                        }
                    }
                }
                
                return null;
            }
            
            // Proses booking
            document.getElementById('btnBooking').addEventListener('click', function() {
                // Jika yang login adalah owner, tidak boleh melakukan booking
                if (isOwnerLoggedIn) {
                    alert('Owner tidak dapat melakukan booking. Silakan logout terlebih dahulu.');
                    return;
                }
                
                const nama = document.getElementById('nama').value;
                const hp = document.getElementById('hp').value;
                const ruanganId = document.getElementById('ruangan').value;
                const tanggal = document.getElementById('tanggal').value;
                const jamMulai = document.getElementById('jamMulai').value;
                const durasi = document.getElementById('durasi').value;
                
                if (!nama || !ruanganId || !tanggal || !jamMulai) {
                    alert('Harap isi semua field yang wajib!');
                    return;
                }
                
                // Validasi metode pembayaran
                if (!selectedPaymentMethod) {
                    alert('Pilih metode pembayaran terlebih dahulu!');
                    return;
                }
                
                // Validasi tanggal untuk client
                if (!isKasirLoggedIn && tanggal !== todayFormatted && tanggal !== tomorrowFormatted) {
                    alert('Booking hanya dapat dilakukan untuk hari ini dan besok saja.');
                    return;
                }
                
                // Validasi jam mulai (08:00 - 24:00)
                const jamMulaiHour = parseInt(jamMulai.split(':')[0]);
                if (jamMulaiHour < 8 || jamMulaiHour > 23) {
                    alert('Jam booking hanya tersedia antara 08:00 - 24:00');
                    return;
                }
                
                // Validasi durasi
                if (jamMulaiHour + parseInt(durasi) > 24) {
                    alert('Booking tidak bisa melebihi jam 24:00');
                    return;
                }
                
                // Cek bentrok jam
                const bentrok = cekBentrokJam(ruanganId, tanggal, jamMulai, durasi);
                if (bentrok) {
                    document.getElementById('jamError').textContent = bentrok;
                    alert(`Terjadi bentrok jam: ${bentrok}`);
                    return;
                } else {
                    document.getElementById('jamError').textContent = '';
                }
                
                // Hitung jam selesai (dengan jeda 5 menit)
                const jamSelesaiHour = jamMulaiHour + parseInt(durasi);
                const jamSelesai = `${jamSelesaiHour.toString().padStart(2, '0')}:05`;
                
                // Hitung total harga
                const selectedRuangan = ruangan.find(r => r.id == ruanganId);
                const totalHarga = selectedRuangan.harga * durasi;
                
                // Simpan data booking sementara
                currentBookingData = {
                    id: bookings.length > 0 ? Math.max(...bookings.map(b => b.id)) + 1 : 1,
                    ruanganId: parseInt(ruanganId),
                    nama: nama,
                    hp: hp,
                    tanggal: tanggal,
                    jamMulai: jamMulai,
                    jamSelesai: jamSelesai,
                    durasi: parseInt(durasi),
                    totalHarga: totalHarga,
                    paymentMethod: selectedPaymentMethod,
                    paymentStatus: selectedPaymentMethod === 'cash' ? 'pending' : 'unpaid'
                };
                
                // Jika metode pembayaran cash, langsung simpan booking
                if (selectedPaymentMethod === 'cash') {
                    bookings.push(currentBookingData);
                    localStorage.setItem('bookings', JSON.stringify(bookings));
                    
                    alert(`Booking berhasil!\nAtas nama: ${nama}\nRuangan: ${ruangan.find(r => r.id == ruanganId).nama}\nTanggal: ${tanggal}\nWaktu: ${jamMulai} - ${jamSelesai}\nTotal Harga: Rp ${totalHarga.toLocaleString('id-ID')}\n\nSilakan lakukan pembayaran di tempat.`);
                    
                    // Reset form
                    resetForm();
                    
                    // Refresh daftar ruangan untuk menampilkan booking baru
                    tampilkanRuangan();
                    if (isKasirLoggedIn) {
                        tampilkanDataBooking();
                    }
                    if (isOwnerLoggedIn) {
                        tampilkanDataOwner();
                        updateInsights();
                    }
                } 
                // Jika metode pembayaran Xendit, tampilkan modal pembayaran
                else if (selectedPaymentMethod === 'xendit') {
                    // Tampilkan modal pembayaran Xendit
                    document.getElementById('paymentAmount').textContent = `Rp ${totalHarga.toLocaleString('id-ID')}`;
                    document.getElementById('vaAmount').textContent = `Rp ${totalHarga.toLocaleString('id-ID')}`;
                    
                    // Generate virtual account number (simulasi)
                    const vaNumber = '88888' + Math.floor(10000 + Math.random() * 90000);
                    document.getElementById('vaNumber').textContent = vaNumber;
                    
                    document.getElementById('paymentModal').style.display = 'flex';
                }
            });
            
            // Proses pembayaran Xendit
            document.getElementById('btnProcessPayment').addEventListener('click', function() {
                const paymentMethod = document.getElementById('paymentMethod').value;
                
                // Tampilkan status processing
                document.getElementById('paymentInstructions').style.display = 'none';
                document.getElementById('paymentProcessing').style.display = 'block';
                
                // Simulasi proses pembayaran Xendit
                setTimeout(function() {
                    // Simpan booking dengan status paid
                    currentBookingData.paymentStatus = 'paid';
                    currentBookingData.xenditMethod = paymentMethod;
                    bookings.push(currentBookingData);
                    localStorage.setItem('bookings', JSON.stringify(bookings));
                    
                    // Tampilkan pesan sukses
                    document.getElementById('paymentProcessing').style.display = 'none';
                    document.getElementById('paymentSuccess').style.display = 'block';
                }, 3000);
            });
            
            // Tutup modal pembayaran
            document.getElementById('btnClosePayment').addEventListener('click', function() {
                document.getElementById('paymentModal').style.display = 'none';
                document.getElementById('paymentInstructions').style.display = 'block';
                document.getElementById('paymentSuccess').style.display = 'none';
                document.getElementById('paymentProcessing').style.display = 'none';
                
                // Reset form
                resetForm();
                
                // Refresh daftar ruangan untuk menampilkan booking baru
                tampilkanRuangan();
                if (isKasirLoggedIn) {
                    tampilkanDataBooking();
                }
                if (isOwnerLoggedIn) {
                    tampilkanDataOwner();
                    updateInsights();
                }
            });
            
            // Tutup modal pembayaran dengan tomclose
            document.getElementById('closePaymentModal').addEventListener('click', function() {
                document.getElementById('paymentModal').style.display = 'none';
                document.getElementById('paymentInstructions').style.display = 'block';
                document.getElementById('paymentSuccess').style.display = 'none';
                document.getElementById('paymentProcessing').style.display = 'none';
            });
            
            // Fungsi reset form
            function resetForm() {
                document.getElementById('nama').value = '';
                document.getElementById('hp').value = '';
                document.getElementById('ruangan').value = '';
                document.getElementById('jamMulai').value = '';
                document.getElementById('durasi').value = '1';
                document.getElementById('harga').textContent = '0';
                document.getElementById('paymentOptions').style.display = 'none';
                
                // Reset seleksi pembayaran
                document.querySelectorAll('.payment-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                selectedPaymentMethod = null;
                currentBookingData = null;
            }
            
            // Login sebagai kasir
            document.getElementById('btnKasir').addEventListener('click', function() {
                const password = prompt('Masukkan password kasir:');
                if (password === 'kasir123') {
                    loginUser('kasir');
                    alert('Login berhasil sebagai kasir!');
                } else {
                    alert('Password salah!');
                }
            });
            
            // Login sebagai owner
            document.getElementById('btnOwner').addEventListener('click', function() {
                const password = prompt('Masukkan password owner:');
                if (password === 'owner123') {
                    loginUser('owner');
                    alert('Login berhasil sebagai owner!');
                } else {
                    alert('Password salah!');
                }
            });
            
            // Fungsi login user
            function loginUser(role) {
                if (role === 'kasir') {
                    isKasirLoggedIn = true;
                    isOwnerLoggedIn = false;
                    document.getElementById('kasirSection').style.display = 'block';
                    document.getElementById('ownerSection').style.display = 'none';
                    document.getElementById('bookingForm').style.display = 'block';
                    
                    // Hilangkan batasan tanggal untuk kasir
                    document.getElementById('tanggal').removeAttribute('max');
                    
                    tampilkanDataBooking();
                } else if (role === 'owner') {
                    isOwnerLoggedIn = true;
                    isKasirLoggedIn = false;
                    document.getElementById('ownerSection').style.display = 'block';
                    document.getElementById('kasirSection').style.display = 'none';
                    document.getElementById('bookingForm').style.display = 'none'; // Sembunyikan form booking
                    
                    // Hilangkan batasan tanggal untuk owner
                    document.getElementById('tanggal').removeAttribute('max');
                    
                    tampilkanDataOwner();
                    updateInsights();
                }
                
                currentUserRole = role;
                document.getElementById('btnKasir').style.display = 'none';
                document.getElementById('btnOwner').style.display = 'none';
                document.getElementById('btnLogout').style.display = 'inline-block';
                
                tampilkanRuangan(); // Refresh untuk menampilkan tombol edit/hapus jika kasir
            }
            
            // Logout
            document.getElementById('btnLogout').addEventListener('click', function() {
                isKasirLoggedIn = false;
                isOwnerLoggedIn = false;
                document.getElementById('kasirSection').style.display = 'none';
                document.getElementById('ownerSection').style.display = 'none';
                document.getElementById('bookingForm').style.display = 'block'; // Tampilkan kembali form booking
                document.getElementById('btnKasir').style.display = 'inline-block';
                document.getElementById('btnOwner').style.display = 'inline-block';
                document.getElementById('btnLogout').style.display = 'none';
                
                // Kembalikan batasan tanggal untuk client
                document.getElementById('tanggal').setAttribute('max', tomorrowFormatted);
                
                tampilkanRuangan(); // Refresh untuk menghilangkan tombol edit/hapus
                alert('Logout berhasil!');
            });
            
            // Filter data booking
            document.getElementById('btnFilter').addEventListener('click', function() {
                tampilkanDataBooking();
            });
            
            // Reset filter
            document.getElementById('btnResetFilter').addEventListener('click', function() {
                document.getElementById('filterTanggal').value = todayFormatted;
                tampilkanDataBooking();
            });
            
            // Filter data owner
            document.getElementById('btnOwnerFilter').addEventListener('click', function() {
                tampilkanDataOwner();
                updateInsights();
            });
            
            // Reset filter owner
            document.getElementById('btnOwnerResetFilter').addEventListener('click', function() {
                document.getElementById('ownerFilterTanggal').value = thirtyDaysAgoFormatted;
                document.getElementById('ownerFilterTanggalEnd').value = todayFormatted;
                tampilkanDataOwner();
                updateInsights();
            });
            
            // Download data
            document.getElementById('btnDownloadData').addEventListener('click', function() {
                downloadDataCSV();
            });
            
            // Fungsi untuk menampilkan data booking di panel kasir
            function tampilkanDataBooking() {
                const filterTanggal = document.getElementById('filterTanggal').value;
                const tableBody = document.getElementById('bookingTableBody');
                
                // Kosongkan tabel
                tableBody.innerHTML = '';
                
                // Filter booking berdasarkan tanggal
                const filteredBookings = filterTanggal ? 
                    bookings.filter(b => b.tanggal === filterTanggal) : 
                    bookings;
                
                if (filteredBookings.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="10" style="text-align: center;">Tidak ada data booking</td></tr>';
                    return;
                }
                
                // Urutkan booking berdasarkan tanggal dan jam
                filteredBookings.sort((a, b) => {
                    if (a.tanggal !== b.tanggal) {
                        return a.tanggal.localeCompare(b.tanggal);
                    }
                    return a.jamMulai.localeCompare(b.jamMulai);
                });
                
                // Isi tabel dengan data booking
                filteredBookings.forEach((booking, index) => {
                    const row = document.createElement('tr');
                    const ruanganInfo = ruangan.find(r => r.id === booking.ruanganId);
                    const paymentStatus = booking.paymentStatus === 'paid' ? 'Lunas' : booking.paymentStatus === 'pending' ? 'Menunggu Pembayaran' : 'Belum Bayar';
                    const statusClass = booking.paymentStatus === 'paid' ? 'available' : 'unavailable';
                    
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${booking.nama}</td>
                        <td>${booking.hp || '-'}</td>
                        <td>${ruanganInfo ? ruanganInfo.nama : 'Tidak Diketahui'}</td>
                        <td>${booking.tanggal}</td>
                        <td>${booking.jamMulai} - ${booking.jamSelesai}</td>
                        <td>${booking.durasi} jam</td>
                        <td>Rp ${booking.totalHarga.toLocaleString('id-ID')}</td>
                        <td class="${statusClass}">${paymentStatus}</td>
                        <td>
                            <button class="edit-btn action-btn" data-id="${booking.id}">Edit</button>
                            <button class="delete-btn action-btn" data-id="${booking.id}">Hapus</button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Tambahkan event listener untuk tombol edit dan hapus
                document.querySelectorAll('#bookingTableBody .edit-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const bookingId = parseInt(this.getAttribute('data-id'));
                        bukaModalEdit(bookingId);
                    });
                });
                
                document.querySelectorAll('#bookingTableBody .delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const bookingId = parseInt(this.getAttribute('data-id'));
                        hapusBooking(bookingId);
                    });
                });
            }
            
            // Fungsi untuk menampilkan data di panel owner
            function tampilkanDataOwner() {
                const filterTanggalStart = document.getElementById('ownerFilterTanggal').value;
                const filterTanggalEnd = document.getElementById('ownerFilterTanggalEnd').value;
                const tableBody = document.getElementById('ownerTableBody');
                
                // Kosongkan tabel
                tableBody.innerHTML = '';
                
                // Filter booking berdasarkan tanggal
                const filteredBookings = bookings.filter(b => {
                    return b.tanggal >= filterTanggalStart && b.tanggal <= filterTanggalEnd;
                });
                
                if (filteredBookings.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center;">Tidak ada data booking</td></tr>';
                    return;
                }
                
                // Urutkan booking berdasarkan tanggal dan jam
                filteredBookings.sort((a, b) => {
                    if (a.tanggal !== b.tanggal) {
                        return a.tanggal.localeCompare(b.tanggal);
                    }
                    return a.jamMulai.localeCompare(b.jamMulai);
                });
                
                // Isi tabel dengan data booking
                filteredBookings.forEach((booking, index) => {
                    const row = document.createElement('tr');
                    const ruanganInfo = ruangan.find(r => r.id === booking.ruanganId);
                    const paymentStatus = booking.paymentStatus === 'paid' ? 'Lunas' : booking.paymentStatus === 'pending' ? 'Menunggu Pembayaran' : 'Belum Bayar';
                    
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${booking.nama}</td>
                        <td>${booking.hp || '-'}</td>
                        <td>${ruanganInfo ? ruanganInfo.nama : 'Tidak Diketahui'}</td>
                        <td>${booking.tanggal}</td>
                        <td>${booking.jamMulai} - ${booking.jamSelesai}</td>
                        <td>${booking.durasi} jam</td>
                        <td>Rp ${booking.totalHarga.toLocaleString('id-ID')}</td>
                        <td>${paymentStatus}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }
            
            // Fungsi untuk update insights bisnis
            function updateInsights() {
                const filterTanggalStart = document.getElementById('ownerFilterTanggal').value;
                const filterTanggalEnd = document.getElementById('ownerFilterTanggalEnd').value;
                
                // Filter booking berdasarkan tanggal
                const filteredBookings = bookings.filter(b => {
                    return b.tanggal >= filterTanggalStart && b.tanggal <= filterTanggalEnd;
                });
                
                // Hitung total pendapatan
                const totalPendapatan = filteredBookings.reduce((total, booking) => {
                    return booking.paymentStatus === 'paid' ? total + booking.totalHarga : total;
                }, 0);
                document.getElementById('totalPendapatan').textContent = `Rp ${totalPendapatan.toLocaleString('id-ID')}`;
                
                // Jumlah booking
                document.getElementById('jumlahBooking').textContent = filteredBookings.length;
                
                // Ruangan paling populer
                const ruanganCount = {};
                filteredBookings.forEach(booking => {
                    const ruanganInfo = ruangan.find(r => r.id === booking.ruanganId);
                    const namaRuangan = ruanganInfo ? ruanganInfo.nama : 'Tidak Diketahui';
                    ruanganCount[namaRuangan] = (ruanganCount[namaRuangan] || 0) + 1;
                });
                
                let ruanganPopuler = '-';
                let maxCount = 0;
                for (const [nama, count] of Object.entries(ruanganCount)) {
                    if (count > maxCount) {
                        maxCount = count;
                        ruanganPopuler = nama;
                    }
                }
                document.getElementById('ruanganPopuler').textContent = ruanganPopuler;
                
                // Rata-rata durasi
                const totalDurasi = filteredBookings.reduce((total, booking) => total + booking.durasi, 0);
                const rataDurasi = filteredBookings.length > 0 ? (totalDurasi / filteredBookings.length).toFixed(1) : 0;
                document.getElementById('rataDurasi').textContent = `${rataDurasi} jam`;
                
                // Pendapatan per jenis
                let pendapatanPS4 = 0;
                let pendapatanPS5 = 0;
                
                filteredBookings.forEach(booking => {
                    const ruanganInfo = ruangan.find(r => r.id === booking.ruanganId);
                    if (ruanganInfo && ruanganInfo.jenis === 'PS4' && booking.paymentStatus === 'paid') {
                        pendapatanPS4 += booking.totalHarga;
                    } else if (ruanganInfo && ruanganInfo.jenis === 'PS5' && booking.paymentStatus === 'paid') {
                        pendapatanPS5 += booking.totalHarga;
                    }
                });
                
                document.getElementById('pendapatanPS4').textContent = `PS4: Rp ${pendapatanPS4.toLocaleString('id-ID')}`;
                document.getElementById('pendapatanPS5').textContent = `PS5: Rp ${pendapatanPS5.toLocaleString('id-ID')}`;
                
                // Metode pembayaran
                const paymentMethods = {
                    xendit: 0,
                    cash: 0
                };
                
                filteredBookings.forEach(booking => {
                    if (booking.paymentMethod && booking.paymentStatus === 'paid') {
                        paymentMethods[booking.paymentMethod] = (paymentMethods[booking.paymentMethod] || 0) + 1;
                    }
                });
                
                document.getElementById('paymentXendit').textContent = `Xendit: ${paymentMethods.xendit}`;
                document.getElementById('paymentCash').textContent = `Cash: ${paymentMethods.cash}`;
            }
            
            // Fungsi untuk download data CSV
            function downloadDataCSV() {
                const filterTanggalStart = document.getElementById('ownerFilterTanggal').value;
                const filterTanggalEnd = document.getElementById('ownerFilterTanggalEnd').value;
                
                // Filter booking berdasarkan tanggal
                const filteredBookings = bookings.filter(b => {
                    return b.tanggal >= filterTanggalStart && b.tanggal <= filterTanggalEnd;
                });
                
                if (filteredBookings.length === 0) {
                    alert('Tidak ada data untuk didownload');
                    return;
                }
                
                // Buat header CSV
                let csvContent = "Data Booking Ruangan PlayStation\n\n";
                csvContent += "No,Nama Pemesan,No HP,Ruangan,Tanggal,Waktu,Durasi (jam),Total Harga,Status Pembayaran,Metode Pembayaran\n";
                
                // Tambahkan data booking
filteredBookings.forEach((booking, index) => {
    const ruanganInfo = ruangan.find(r => r.id === booking.ruanganId);
    const namaRuangan = ruanganInfo ? ruanganInfo.nama : 'Tidak Diketahui';
    const paymentStatus = booking.paymentStatus === 'paid'
        ? 'Lunas'
        : booking.paymentStatus === 'pending'
            ? 'Menunggu Pembayaran'
            : 'Belum Bayar';
    const paymentMethod = booking.paymentMethod === 'xendit' ? 'Xendit' : 'Cash';
    
    csvContent += `${index + 1},${booking.nama},${booking.hp || ''},${namaRuangan},${booking.tanggal},${booking.jamMulai} - ${booking.jamSelesai},${booking.durasi},${booking.totalHarga},${paymentStatus},${paymentMethod}\n`;
});

                // Buat file dan download
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                const now = new Date();
                const dateString = now.toISOString().split('T')[0];
                
                link.setAttribute("href", url);
                link.setAttribute("download", `data_booking_${dateString}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            // Fungsi untuk membuka modal edit booking
            function bukaModalEdit(bookingId) {
                const booking = bookings.find(b => b.id === bookingId);
                if (!booking) return;
                
                document.getElementById('editNama').value = booking.nama;
                document.getElementById('editHp').value = booking.hp || '';
                document.getElementById('editRuangan').value = booking.ruanganId;
                document.getElementById('editTanggal').value = booking.tanggal;
                document.getElementById('editJamMulai').value = booking.jamMulai;
                document.getElementById('editDurasi').value = booking.durasi;
                
                // Simpan ID booking yang sedang diedit
                document.getElementById('btnUpdateBooking').setAttribute('data-id', bookingId);
                
                // Tampilkan modal
                document.getElementById('editModal').style.display = 'flex';
            }
            
            // Tutup modal edit
            document.getElementById('closeEditModal').addEventListener('click', function() {
                document.getElementById('editModal').style.display = 'none';
            });
            
            // Update booking
            document.getElementById('btnUpdateBooking').addEventListener('click', function() {
                const bookingId = parseInt(this.getAttribute('data-id'));
                const bookingIndex = bookings.findIndex(b => b.id === bookingId);
                
                if (bookingIndex === -1) return;
                
                const nama = document.getElementById('editNama').value;
                const hp = document.getElementById('editHp').value;
                const tanggal = document.getElementById('editTanggal').value;
                const jamMulai = document.getElementById('editJamMulai').value;
                const durasi = parseInt(document.getElementById('editDurasi').value);
                
                if (!nama || !tanggal || !jamMulai) {
                    alert('Harap isi semua field yang wajib!');
                    return;
                }
                
                // Validasi jam mulai (08:00 - 24:00)
                const jamMulaiHour = parseInt(jamMulai.split(':')[0]);
                if (jamMulaiHour < 8 || jamMulaiHour > 23) {
                    alert('Jam booking hanya tersedia antara 08:00 - 24:00');
                    return;
                }
                
                // Validasi durasi
                if (jamMulaiHour + parseInt(durasi) > 24) {
                    alert('Booking tidak bisa melebihi jam 24:00');
                    return;
                }
                
                // Cek bentrok jam (kecuali dengan booking yang sedang diedit)
                const bentrok = cekBentrokJam(bookings[bookingIndex].ruanganId, tanggal, jamMulai, durasi, bookingId);
                if (bentrok) {
                    alert(`Terjadi bentrok jam: ${bentrok}`);
                    return;
                }
                
                // Hitung jam selesai (dengan jeda 5 menit)
                const jamSelesaiHour = jamMulaiHour + durasi;
                const jamSelesai = `${jamSelesaiHour.toString().padStart(2, '0')}:05`;
                
                // Hitung total harga
                const ruanganInfo = ruangan.find(r => r.id === bookings[bookingIndex].ruanganId);
                const totalHarga = ruanganInfo.harga * durasi;
                
                // Update booking
                bookings[bookingIndex] = {
                    ...bookings[bookingIndex],
                    nama: nama,
                    hp: hp,
                    tanggal: tanggal,
                    jamMulai: jamMulai,
                    jamSelesai: jamSelesai,
                    durasi: durasi,
                    totalHarga: totalHarga
                };
                
                localStorage.setItem('bookings', JSON.stringify(bookings));
                
                alert('Booking berhasil diupdate!');
                
                // Tutup modal dan refresh data
                document.getElementById('editModal').style.display = 'none';
                tampilkanRuangan();
                if (isKasirLoggedIn) {
                    tampilkanDataBooking();
                }
                if (isOwnerLoggedIn) {
                    tampilkanDataOwner();
                    updateInsights();
                }
            });
            
            // Fungsi untuk menghapus booking
            function hapusBooking(bookingId) {
                if (!confirm('Apakah Anda yakin ingin menghapus booking ini?')) return;
                
                bookings = bookings.filter(b => b.id !== bookingId);
                localStorage.setItem('bookings', JSON.stringify(bookings));
                
                alert('Booking berhasil dihapus!');
                
                // Refresh data
                tampilkanRuangan();
                if (isKasirLoggedIn) {
                    tampilkanDataBooking();
                }
                if (isOwnerLoggedIn) {
                    tampilkanDataOwner();
                    updateInsights();
                }
            }
        });
    </script>
</body>
</html>
